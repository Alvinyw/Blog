(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-system"],{"02d0":function(e,t,a){"use strict";var r=a("90a1"),o=a.n(r);o.a},"103c":function(e,t,a){},"1f34":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("UserManage")},o=[],n=a("3c67"),i={name:"SystemUserManagement",components:{UserManage:n["default"]}},l=i,s=a("2877"),d=Object(s["a"])(l,r,o,!1,null,null,null);t["default"]=d.exports},2949:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"systenManage_department"},[a("el-row",[a("el-col",{staticClass:"menuSec",attrs:{span:10}},[a("h3",[e._v("组织架构")]),e._v(" "),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingTreeData,expression:"loadingTreeData"}],ref:"departmentTree",attrs:{data:e.treeData,"check-on-click-node":"","node-key":"code",props:e.defaultProps,"highlight-current":"","default-expanded-keys":[e.currentNodeKey]},on:{"update:data":function(t){e.treeData=t},"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(r.label))]),e._v(" "),e.$api.buttonAuth("department/edit")?a("span",{staticClass:"rightClickMenu"},[a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleAddDepartment(1,o)}}},[e._v("添加子部门")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleAddDepartment(2,o)}}},[e._v("添加同级部门")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleAddDepartment(3,o)}}},[e._v("编辑")])],1):e._e()])}}])})],1),e._v(" "),a("el-col",{staticClass:"editForm",attrs:{span:14}},[a("h3",[e._v(e._s(e.menuName)+" : "+e._s(e.operataName))]),e._v(" "),a("el-form",{ref:"formData",staticStyle:{width:"94%"},attrs:{"label-position":"right","label-width":"150px",model:e.formData,rules:e.department_rules}},[a("el-form-item",{attrs:{label:"父级部门编号",prop:"parentCode"}},[a("el-input",{attrs:{disabled:""},model:{value:e.formData.parentCode,callback:function(t){e.$set(e.formData,"parentCode",t)},expression:"formData.parentCode"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"部门编号",prop:"code"}},[a("el-input",{attrs:{maxlength:"3","show-word-limit":"",disabled:e.ifCodeEditable},model:{value:e.formData.code,callback:function(t){e.$set(e.formData,"code",t)},expression:"formData.code"}},[1===e.operataCode||2===e.operataCode?a("template",{slot:"prepend"},[e._v(e._s(e.formData.parentCode)+"_")]):e._e()],2)],1),e._v(" "),a("el-form-item",{attrs:{label:"部门名称",prop:"name"}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),e.$api.buttonAuth("department/edit")?a("el-form-item",{attrs:{size:"large"}},[a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),3!==e.operataCode?a("el-button",{attrs:{loading:e.ifSubmitting,type:"primary"},on:{click:e.addDepartment}},[e._v("添加")]):a("el-button",{attrs:{loading:e.ifSubmitting,type:"primary",disabled:e.isSubmitDisable},on:{click:e.editDepartment}},[e._v("更新")])],1):e._e()],1)],1)],1)],1)},o=[],n=(a("6b54"),a("7f7f"),a("4360")),i={name:"DepartmentIndex",data:function(){return{currentNodeData:"",currentDefaultNodeData:"",operataCode:-1,loadingTreeData:!1,ifSubmitting:!1,isSubmitDisable:!0,currentNodeKey:"",treeData:[],defaultProps:{children:"children",label:"name"},formData:{code:"",parentCode:"",name:"",updateById:n["a"].getters.userId,createById:n["a"].getters.userId},department_rules:{code:[{required:!0,message:"请输入 code",trigger:"blur"}],parentCode:[{required:!0,message:"请输入 parentCode",trigger:"blur"}],name:[{required:!0,message:"请输入 name",trigger:"blur"}]}}},computed:{menuName:function(){return this.currentNodeData.name?this.currentNodeData.name:"部门"},operataName:function(){switch(this.operataCode){case 1:return"添加子部门";case 2:return"添加同级部门";case 3:return"编辑";default:return"管理"}},ifCodeEditable:function(){return 3===this.operataCode}},watch:{formData:{handler:function(e,t){this.isSubmitDisable=this.$lib.isObjEqual(e,this.currentDefaultNodeData)},deep:!0}},mounted:function(){this.getTreeData()},updated:function(){this.$refs.departmentTree.setCurrentKey(this.currentNodeKey)},methods:{setData:function(e){this.treeData=this.$dataFormater.generateDepartment(e),this.loadingTreeData=!1},getTreeData:function(){var e=this;this.loadingTreeData=!0,this.$api.department.getDepartment().then(function(t){e.setData(t.data)})},handleNodeClick:function(e,t,a){this.clearForm(),this.currentNodeKey=e.code},handleAddDepartment:function(e,t){this.operataCode=e,this.currentNodeData=t,this.currentNodeKey=t.code,this.resetForm()},updateFormData:function(){var e=this.operataCode,t=this.currentNodeData;3===e?(this.formData={code:t.code.toString(),parentCode:t.parentCode.toString(),name:t.name,updateById:n["a"].getters.userId},this.currentDefaultNodeData=JSON.parse(JSON.stringify(this.formData))):this.formData={parentCode:1===e?t.code.toString():2===e?t.parentCode.toString():"",name:"",createById:n["a"].getters.userId}},addDepartment:function(){var e=this;this.$refs["formData"].validate(function(t){if(!t)return!1;e.ifSubmitting=!0,e.$api.department.addDepartment(e.formaterFormData()).then(function(t){e.clearForm(),e.getTreeData(),e.ifSubmitting=!1}).catch(function(t){e.ifSubmitting=!1,e.$message.error(t.message)})})},editDepartment:function(){var e=this;this.$refs["formData"].validate(function(t){if(!t)return!1;e.ifSubmitting=!0,e.$api.department.editDepartment(e.formData).then(function(t){e.clearForm(),e.getTreeData(),e.ifSubmitting=!1}).catch(function(t){e.ifSubmitting=!1,e.$message.error(t.message)})})},clearForm:function(){this.currentNodeData="",this.operataCode=-1,this.updateFormData()},resetForm:function(){this.updateFormData()},formaterFormData:function(){var e=JSON.parse(JSON.stringify(this.formData));return e.code=e.parentCode+"_"+e.code,e}}},l=i,s=(a("4836"),a("6e1c"),a("2877")),d=Object(s["a"])(l,r,o,!1,null,"5d2bb558",null);t["default"]=d.exports},"3c67":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"systemUserManagement"},[a("el-form",{ref:"queryCondition",staticClass:"queryCondition section",attrs:{model:e.queryCondition,rules:e.userQueryRules}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"用户名称",prop:"name","label-width":"75px"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:"",maxlength:"20","show-word-limit":""},model:{value:e.queryCondition.name,callback:function(t){e.$set(e.queryCondition,"name",t)},expression:"queryCondition.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"账号名",prop:"account","label-width":"100px"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:"",maxlength:"50","show-word-limit":""},model:{value:e.queryCondition.account,callback:function(t){e.$set(e.queryCondition,"account",t)},expression:"queryCondition.account"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"用户电话",prop:"phone","label-width":"110px"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:"",maxlength:"11","show-word-limit":""},model:{value:e.queryCondition.phone,callback:function(t){e.$set(e.queryCondition,"phone",e._n(t))},expression:"queryCondition.phone"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:4}},[a("el-form-item",{staticClass:"queryBtn",attrs:{size:"large","label-width":"0"}},[e.$api.buttonAuth("user/add")&&!e.onlyMerchantUser?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.showUserAddDialog=!0}}},[e._v("新增")]):e._e()],1)],1),e._v(" "),a("el-col",{attrs:{span:20}},[a("el-form-item",{staticClass:"queryBtn",staticStyle:{"text-align":"right"},attrs:{size:"large"}},[a("el-button",{on:{click:function(t){return e.resetForm("queryCondition")}}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{loading:e.inQuering,type:"primary"},on:{click:function(t){return e.searchUserData("queryCondition")}}},[e._v("查询")])],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"userDataTable section mb0"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingUserData,expression:"loadingUserData"}],staticStyle:{width:"100%"},attrs:{data:e.userData,"header-cell-style":{background:"#f5f5f5"},"cell-style":{padding:"10px 0"}}},[a("el-table-column",{attrs:{prop:"account",label:"账号名","min-width":"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{title:t.row.account}},[e._v(e._s(t.row.account))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:"用户名称","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{title:t.row.name}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"phone",label:"用户电话","min-width":"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type",label:"用户类型","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(1===t.row.type?"内部用户":"商户用户"))]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"merchantId",label:"商户 Id","min-width":"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"enabled",label:"使用状态","min-width":"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{innerHTML:e._s(e.$app.getEnabledState(t.row.enabled))}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createDatetime",label:"创建时间","min-width":"145"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:e.onlyMerchantUser?"110px":"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.authEditBtn?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEditUser(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.$api.buttonAuth("user/role")&&!e.onlyMerchantUser&&1===t.row.type?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEditUserRole(t.row)}}},[e._v("角色")]):e._e(),e._v(" "),e.authResetPassword?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.resetPassword(t.row)}}},[e._v("重置密码")]):e._e()]}}])})],1),e._v(" "),a("DataPagination",{attrs:{"pagination-data":e.paginationData},on:{"update:paginationData":function(t){e.paginationData=t},"update:pagination-data":function(t){e.paginationData=t},resetData:e.getUserData}})],1),e._v(" "),a("UserAdd",{attrs:{"show-user-add-dialog":e.showUserAddDialog,"only-merchant-user":e.onlyMerchantUser},on:{"update:showUserAddDialog":function(t){e.showUserAddDialog=t},"update:show-user-add-dialog":function(t){e.showUserAddDialog=t},getUserData:e.getUserData}}),e._v(" "),a("UserEdit",{attrs:{"show-user-edit-dialog":e.showUserEditDialog,"only-merchant-user":e.onlyMerchantUser,"current-user-data":e.currentUser},on:{"update:showUserEditDialog":function(t){e.showUserEditDialog=t},"update:show-user-edit-dialog":function(t){e.showUserEditDialog=t},getUserData:e.getUserData}}),e._v(" "),a("UserRoleEdit",{attrs:{"if-show-role-dialog":e.ifShowRoleDialog,"current-user-data":e.currentUser},on:{"update:ifShowRoleDialog":function(t){e.ifShowRoleDialog=t},"update:if-show-role-dialog":function(t){e.ifShowRoleDialog=t}}})],1)},o=[],n=a("db72"),i=a("2f62"),l=a("6078"),s=a("af73"),d=a("6666"),u={name:"UserManage",components:{UserAdd:s["default"],UserEdit:d["default"],UserRoleEdit:l["default"]},props:{onlyMerchantUser:{type:Boolean,default:!1}},data:function(){return{paginationData:{pageIndex:1,pageSize:10,dataCount:0},showUserAddDialog:!1,showUserEditDialog:!1,inQuering:!1,queryCondition:{name:"",account:"",phone:"",userId:"",type:""},userQueryRules:{phone:[{validator:this.$validater.strNumber}]},userData:[],loadingUserData:!1,ifShowRoleDialog:!1,currentUser:{}}},computed:Object(n["a"])({},Object(i["b"])(["userId"]),{authResetPassword:function(){return this.onlyMerchantUser?this.$api.buttonAuth("merchantUser/resetPassword"):this.$api.buttonAuth("user/resetPassword")},authEditBtn:function(){return this.onlyMerchantUser?this.$api.buttonAuth("merchantUser/edit"):this.$api.buttonAuth("user/edit")}}),mounted:function(){this.getUserData();var e=this.$session.getQueryConditions();e&&(this.queryCondition=e)},methods:{setUserData:function(e){this.userData=e.data,this.paginationData.dataCount=e.count,this.loadingUserData=!1},getUserData:function(){var e=this;return this.loadingUserData=!0,this.queryCondition.type=this.onlyMerchantUser?"2":"",this.queryCondition.userId=this.onlyMerchantUser?this.userId:"",this.$api.user.getUser(Object(n["a"])({},this.paginationData,{conditions:this.queryCondition})).then(function(t){e.setUserData(t)}).catch(function(t){e.$message.error(t.message)})},searchUserData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.inQuering=!0,t.getUserData().then(function(e){t.inQuering=!1}).catch(function(){t.loadingUserData=!1,t.inQuering=!1}),t.$session.setQueryConditions(t.queryCondition)})},resetForm:function(e){this.$refs[e].resetFields(),this.$refs[e].clearValidate()},handleEditUser:function(e){this.currentUser=e,this.showUserEditDialog=!0},handleEditUserRole:function(e){this.currentUser=e,this.ifShowRoleDialog=!0},resetPassword:function(e){var t=this;this.$api.user.resetPassword({id:e.id,updateById:this.$store.getters.userId}).then(function(e){t.$message.success(e.message)}).catch(function(e){t.$message.error(e.message)})}}},c=u,f=(a("7102"),a("2877")),h=Object(f["a"])(c,r,o,!1,null,"bce17b70",null);t["default"]=h.exports},"410b":function(e,t,a){},4836:function(e,t,a){"use strict";var r=a("aaaa"),o=a.n(r);o.a},"4e74":function(e,t,a){},6078:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.ifShowDialog,width:"50%",top:"10vh","custom-class":"userManage_roleEditDialog"},on:{"update:visible":function(t){e.ifShowDialog=t}}},[a("div",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"title"},slot:"title"},[e._v("\n    编辑\n    "),a("strong",[e._v(e._s(e.currentUserData.name))]),e._v(" 的角色\n  ")]),e._v(" "),a("el-checkbox-group",{directives:[{name:"loading",rawName:"v-loading",value:e.ifLoadingRoleData,expression:"ifLoadingRoleData"}],model:{value:e.selectedRoleArr,callback:function(t){e.selectedRoleArr=t},expression:"selectedRoleArr"}},[a("el-row",{staticClass:"roleDialog"},e._l(e.roleArr,function(t){return a("el-col",{key:t.id,attrs:{span:4,title:t.name}},[a("el-checkbox",{attrs:{label:t.id,checked:t.isSelected,border:""}},[e._v(e._s(t.name))])],1)}),1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.ifShowDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重 置")]),e._v(" "),a("el-button",{attrs:{loading:e.ifUpdating,type:"primary",disabled:e.isSubmitDisable},on:{click:e.editUserRole}},[e._v("更 新")])],1)],1)},o=[],n=(a("ac6a"),a("4360")),i={name:"UserRoleEditIndex",props:{ifShowRoleDialog:Boolean,currentUserData:{type:Object,default:function(){return{}}}},data:function(){return{roleArr:[],defaultSelectedRoleArr:[],selectedRoleArr:[],ifLoadingRoleData:!1,isSubmitDisable:!0,ifUpdating:!1}},computed:{ifShowDialog:{get:function(){return this.ifShowRoleDialog},set:function(e){this.$emit("update:ifShowRoleDialog",e)}}},watch:{ifShowRoleDialog:function(e,t){var a=this;e?(this.ifLoadingRoleData=!0,this.$api.role.getRoleByUser({id:this.currentUserData.id}).then(function(e){a.roleArr=e.data?e.data:[],a.roleArr.forEach(function(e){e.isSelected&&a.defaultSelectedRoleArr.push(e.id)}),a.ifLoadingRoleData=!1}).catch(function(e){a.$message.error(e.message)})):(this.roleArr=[],this.defaultSelectedRoleArr=[],this.selectedRoleArr=[])},selectedRoleArr:{handler:function(e,t){this.isSubmitDisable=this.$lib.isObjEqual(e,this.defaultSelectedRoleArr)},deep:!0}},methods:{editUserRole:function(){var e=this;this.ifUpdating=!0,this.$api.user.editUserRole({finUserId:this.currentUserData.id,roleIds:this.selectedRoleArr,createById:n["a"].getters.userId}).then(function(t){e.ifUpdating=!1,e.ifShowDialog=!1}).catch(function(t){e.ifShowDialog=!1,e.$message.error(t.message)})},resetForm:function(){this.selectedRoleArr=JSON.parse(JSON.stringify(this.defaultSelectedRoleArr))}}},l=i,s=(a("783d"),a("866c"),a("2877")),d=Object(s["a"])(l,r,o,!1,null,"4ce11283",null);t["default"]=d.exports},6332:function(e,t,a){"use strict";var r=a("f4c9"),o=a.n(r);o.a},6666:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.showDialog,width:"700px",top:"10vh"},on:{"update:visible":function(t){e.showDialog=t}}},[a("div",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"title"},slot:"title"},[e._v("\n    编辑\n    "),a("strong",[e._v(e._s(e.currentUserData.name))]),e._v(" 的信息\n  ")]),e._v(" "),a("el-form",{ref:"newUserData",attrs:{model:e.newUserData,rules:e.newUserDataRule}},[a("el-form-item",{attrs:{label:"账号名",prop:"account","label-width":e.labelWidth}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":"",autocomplete:"off",disabled:""},model:{value:e.newUserData.account,callback:function(t){e.$set(e.newUserData,"account",t)},expression:"newUserData.account"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户名称",prop:"name","label-width":e.labelWidth}},[a("el-input",{attrs:{autocomplete:"off",maxlength:"20","show-word-limit":""},model:{value:e.newUserData.name,callback:function(t){e.$set(e.newUserData,"name",t)},expression:"newUserData.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号码",prop:"phone","label-width":e.labelWidth}},[a("el-input",{attrs:{maxlength:"11","show-word-limit":"",autocomplete:"off"},model:{value:e.newUserData.phone,callback:function(t){e.$set(e.newUserData,"phone",t)},expression:"newUserData.phone"}})],1),e._v(" "),e.onlyMerchantUser?e._e():a("el-form-item",{attrs:{label:"用户类型",prop:"type","label-width":e.labelWidth}},[a("el-radio",{attrs:{label:"1"},model:{value:e.newUserData.type,callback:function(t){e.$set(e.newUserData,"type",t)},expression:"newUserData.type"}},[e._v("内部用户")]),e._v(" "),a("el-radio",{attrs:{label:"2"},model:{value:e.newUserData.type,callback:function(t){e.$set(e.newUserData,"type",t)},expression:"newUserData.type"}},[e._v("商户用户")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"1"===e.newUserData.type,expression:"newUserData.type === '1'"}],attrs:{label:"组织架构",prop:"departmentCode","label-width":e.labelWidth,rules:[{required:"1"===e.newUserData.type,message:"请选择组织架构"}]}},[a("el-cascader",{attrs:{options:e.departmentOptions,props:{checkStrictly:!0,value:"code",label:"name",expandTrigger:"hover"},clearable:""},model:{value:e.newUserData.departmentCode,callback:function(t){e.$set(e.newUserData,"departmentCode",t)},expression:"newUserData.departmentCode"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"2"===e.newUserData.type,expression:"newUserData.type === '2'"}],attrs:{label:"对应商户",prop:"merchantId","label-width":e.labelWidth,rules:[{required:"2"===e.newUserData.type,message:"请选择对应商户"}]}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:e.newUserData.merchantId,callback:function(t){e.$set(e.newUserData,"merchantId",t)},expression:"newUserData.merchantId"}},e._l(e.aryMerchantId,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启用",prop:"enabled","label-width":e.labelWidth}},[a("el-radio",{attrs:{label:"true"},model:{value:e.newUserData.enabled,callback:function(t){e.$set(e.newUserData,"enabled",t)},expression:"newUserData.enabled"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"false"},model:{value:e.newUserData.enabled,callback:function(t){e.$set(e.newUserData,"enabled",t)},expression:"newUserData.enabled"}},[e._v("否")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重 置")]),e._v(" "),a("el-button",{attrs:{loading:e.ifSubmitting,type:"primary",disabled:e.isSubmitDisable},on:{click:function(t){return e.editUser()}}},[e._v("更新")])],1)],1)},o=[],n=(a("28a5"),a("6b54"),a("ac6a"),a("4360")),i={name:"UserAdd",props:{currentUserData:{type:Object,default:function(){return{account:"",password:"",name:"",phone:"",type:"1",sex:"1",merchantId:"",enabled:"true",departmentCode:"",updateById:n["a"].getters.userId}}},showUserEditDialog:{type:Boolean,default:!1},onlyMerchantUser:{type:Boolean,default:!1}},data:function(){return{ifSubmitting:!1,aryMerchantId:[],isSubmitDisable:!0,departmentOptions:[],defaultNewUserData:"",newUserData:{},newUserDataRule:{account:[{required:!0,message:"请输入账号名",trigger:"blur"}],name:[{required:!0,message:"请输入用户名称",trigger:"blur"}],phone:[{required:!0,message:"请填写手机号"},{validator:this.$validater.strNumber,trigger:"blur"}],type:[{required:!0,message:"请选择用户类型",trigger:"blur"}]},labelWidth:"90px"}},computed:{showDialog:{get:function(){return this.showUserEditDialog},set:function(e){this.$emit("update:showUserEditDialog",e)}}},watch:{showDialog:function(e){var t=this;e&&(0===this.aryMerchantId.length&&this.$api.merchant.getEnabledMerchant().then(function(e){t.aryMerchantId=[],e.data.forEach(function(e){t.aryMerchantId.push({value:e.id,label:e.shortName})})}),0===this.departmentOptions.length&&this.$api.department.getDepartment().then(function(e){t.departmentOptions=t.$dataFormater.generateDepartment(e.data)}))},currentUserData:function(e,t){var a=Object.assign({},e);a.type=a.type.toString(),a.sex=a.sex?a.sex.toString():"",a.enabled=a.enabled.toString(),a.departmentCode=this.spiltDepartmentCodeAry(a.departmentCode?a.departmentCode:""),a.updateById=this.$store.getters.userId,this.newUserData=a,this.defaultNewUserData=JSON.parse(JSON.stringify(this.newUserData))},newUserData:{handler:function(e,t){this.isSubmitDisable=this.$lib.isObjEqual(e,this.defaultNewUserData)},deep:!0}},methods:{spiltDepartmentCodeAry:function(e){var t=e.split("_"),a=[];return t.forEach(function(e,t){var r=a[t-1];r?a.push(r+"_"+e):a.push(e)}),a},editUser:function(){var e=this;this.$refs["newUserData"].validate(function(t){if(!t)return!1;e.ifSubmitting=!0,e.$api.user.editUser(e.formateNewUserData(e.newUserData)).then(function(t){e.showDialog=!1,e.ifSubmitting=!1,e.$emit("getUserData"),e.resetForm()}).catch(function(t){e.ifSubmitting=!1,e.$message.error(t.message)})})},formateNewUserData:function(e){var t=Object.assign({},e);return"1"===t.type?(t.merchantId="",t.departmentCode=t.departmentCode[t.departmentCode.length-1]):"2"===t.type&&(t.departmentCode=""),t},resetForm:function(){this.newUserData=JSON.parse(JSON.stringify(this.defaultNewUserData))}}},l=i,s=(a("7066"),a("2877")),d=Object(s["a"])(l,r,o,!1,null,"525a1176",null);t["default"]=d.exports},"6d75":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.ifShowDialog,width:"30%",top:"5vh","custom-class":"roleManage_resourceEditDialog"},on:{"update:visible":function(t){e.ifShowDialog=t}}},[a("div",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"title"},slot:"title"},[e._v("\n    编辑\n    "),a("strong",[e._v(e._s(e.currentRoleData.name))]),e._v(" 的资源\n  ")]),e._v(" "),a("div",{attrs:{slot:"default",id:"roleResourceTree"},slot:"default"},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.ifLoadingRoleData,expression:"ifLoadingRoleData"}],ref:"resourceTree",attrs:{data:e.treeData,"check-on-click-node":"","node-key":"id",props:e.defaultProps,"highlight-current":"","show-checkbox":"","check-strictly":"",accordion:"","default-expand-all":!1},on:{"update:data":function(t){e.treeData=t},check:e.handleCheck}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.ifShowDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重 置")]),e._v(" "),a("el-button",{attrs:{loading:e.isUpdating,type:"primary",disabled:e.isSubmitDisable},on:{click:e.editRoleResource}},[e._v("更 新")])],1)])},o=[],n=(a("ac6a"),a("4360")),i=a("0003"),l={name:"RoleResourceEditIndex",props:{ifShowResourceDialog:Boolean,currentRoleData:{type:Object,default:function(){return{}}}},data:function(){return{ifLoadingRoleData:!1,isSubmitDisable:!0,isUpdating:!1,defaultProps:{children:"children",label:"name"},defaultAllResourceData:[],defaultCheckedKeys:[],currentCheckedKeys:[],allResourceData:[],treeData:[]}},computed:{ifShowDialog:{get:function(){return this.ifShowResourceDialog},set:function(e){this.$emit("update:ifShowResourceDialog",e)}}},watch:{ifShowDialog:function(e,t){var a=this;e?(this.ifLoadingRoleData=!0,this.$api.resource.getResourceByRole(this.currentRoleData).then(function(e){a.defaultAllResourceData=e.data,a.allResourceData=JSON.parse(JSON.stringify(a.defaultAllResourceData)),a.treeData=Object(i["b"])(a.allResourceData),a.ifLoadingRoleData=!1})):(this.defaultCheckedKeys=[],this.currentCheckedKeys=[],this.allResourceData=[],this.treeData=[])},allResourceData:{handler:function(e,t){var a=this;this.currentCheckedKeys=[],e.forEach(function(e){e.isSelected&&a.currentCheckedKeys.push(e.id)}),0===t.length&&(this.defaultCheckedKeys=this.currentCheckedKeys),this.$refs.resourceTree.setCheckedKeys(this.currentCheckedKeys),this.isSubmitDisable=this.$lib.isObjEqual(e,this.defaultAllResourceData)},deep:!0}},methods:{handleCheck:function(e,t){var a=this;this.allResourceData.forEach(function(t){t.id===e.id&&(t.isSelected=!t.isSelected,t.isSelected&&a.reInitParents(t),a.reInitChilds(t))})},reInitParents:function(e){var t=this;this.allResourceData.forEach(function(a){a.id===e.parentId&&(a.isSelected=!0,t.reInitParents(a))})},reInitChilds:function(e){var t=this;this.allResourceData.forEach(function(a){a.parentId===e.id&&(a.isSelected=e.isSelected,t.reInitChilds(a))})},editRoleResource:function(){var e=this;this.isUpdating=!0,this.$api.role.editRoleResource({roleId:this.currentRoleData.id,resourceIds:this.currentCheckedKeys,createById:n["a"].getters.userId}).then(function(t){e.isUpdating=!1,e.ifShowDialog=!1}).catch(function(t){return e.ifShowDialog=!1,e.$message.error(t.message),!1})},resetForm:function(){this.allResourceData=JSON.parse(JSON.stringify(this.defaultAllResourceData))}}},s=l,d=(a("8c703"),a("2877")),u=Object(d["a"])(s,r,o,!1,null,null,null);t["default"]=u.exports},"6e1c":function(e,t,a){"use strict";var r=a("a6e3"),o=a.n(r);o.a},7066:function(e,t,a){"use strict";var r=a("bff3"),o=a.n(r);o.a},"70eb":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"roleManagement"},[a("el-form",{ref:"queryCondition",staticClass:"queryCondition section",attrs:{model:e.queryCondition,rules:e.queryRules}},[a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name","label-width":"80px"}},[a("el-input",{attrs:{maxlength:"20",clearable:"",placeholder:"请输入","show-word-limit":""},model:{value:e.queryCondition.name,callback:function(t){e.$set(e.queryCondition,"name",t)},expression:"queryCondition.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:18}},[a("el-form-item",{attrs:{size:"large","label-width":"40px"}},[a("el-button",{attrs:{loading:e.inQuering,type:"primary"},on:{click:function(t){return e.searchRoleData("queryCondition")}}},[e._v("查询")]),e._v(" "),e.$api.buttonAuth("role/add")?a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.ifShowAddRoleDialog=!0}}},[e._v("新增")]):e._e()],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"roleDataTable section mb0"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingRoleData,expression:"loadingRoleData"}],staticStyle:{width:"100%"},attrs:{data:e.roleData,"header-cell-style":{background:"#f5f5f5"},"cell-style":{padding:"10px 0"}}},[a("el-table-column",{attrs:{prop:"name",label:"角色名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{title:t.row.name}},[e._v(e._s(t.row.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"remark",label:"角色描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{attrs:{title:t.row.remark}},[e._v(e._s(t.row.remark))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"enabled",label:"使用状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{domProps:{innerHTML:e._s(e.$app.getEnabledState(t.row.enabled))}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"createDatetime",label:"创建时间"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"90"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.$api.buttonAuth("role/edit")?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEditRole(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),e.$api.buttonAuth("role/resource")?a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleEditRoleResource(t.row)}}},[e._v("资源")]):e._e()]}}])})],1),e._v(" "),a("DataPagination",{attrs:{"pagination-data":e.paginationData},on:{"update:paginationData":function(t){e.paginationData=t},"update:pagination-data":function(t){e.paginationData=t},resetData:e.getRoleData}})],1),e._v(" "),a("RoleAdd",{attrs:{"if-show-add-role-dialog":e.ifShowAddRoleDialog},on:{"update:ifShowAddRoleDialog":function(t){e.ifShowAddRoleDialog=t},"update:if-show-add-role-dialog":function(t){e.ifShowAddRoleDialog=t},getRoleData:e.getRoleData}}),e._v(" "),a("RoleEdit",{attrs:{"if-show-edit-role-dialog":e.ifShowEditRoleDialog,"current-role-data":e.currentRole},on:{"update:ifShowEditRoleDialog":function(t){e.ifShowEditRoleDialog=t},"update:if-show-edit-role-dialog":function(t){e.ifShowEditRoleDialog=t},getRoleData:e.getRoleData}}),e._v(" "),a("RoleResourceEdit",{attrs:{"if-show-resource-dialog":e.ifShowEditResourceDialog,"current-role-data":e.currentRole},on:{"update:ifShowResourceDialog":function(t){e.ifShowEditResourceDialog=t},"update:if-show-resource-dialog":function(t){e.ifShowEditResourceDialog=t}}})],1)},o=[],n=(a("6b54"),a("7f7f"),a("db72")),i=a("4360"),l=a("6d75"),s=a("ac66"),d=a("d716"),u={name:"SystemRole",components:{RoleResourceEdit:l["default"],RoleAdd:s["default"],RoleEdit:d["default"]},data:function(){return{ifShowAddRoleDialog:!1,ifShowEditRoleDialog:!1,ifShowEditResourceDialog:!1,inQuering:!1,paginationData:{pageIndex:1,pageSize:10,dataCount:0},queryCondition:{name:""},queryRules:{},roleData:[],loadingRoleData:!1,currentRole:{}}},mounted:function(){this.getRoleData();var e=this.$session.getQueryConditions();e&&(this.queryCondition=e)},methods:{setRoleData:function(e){this.roleData=e.data,this.paginationData.dataCount=e.count,this.loadingRoleData=!1},getRoleData:function(){var e=this;return this.loadingRoleData=!0,this.$api.role.getRole(Object(n["a"])({},this.paginationData,{conditions:this.queryCondition})).then(function(t){e.setRoleData(t)}).catch(function(t){e.$message.error(t.message)})},searchRoleData:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return!1;t.inQuering=!0,t.getRoleData().then(function(e){t.inQuering=!1}).catch(function(){t.loadingRoleData=!1,t.inQuering=!1}),t.$session.setQueryConditions(t.queryCondition)})},handleEditRole:function(e){this.ifShowEditRoleDialog=!0,this.currentRole={id:e.id,name:e.name,remark:e.remark,enabled:e.enabled.toString(),updateById:i["a"].getters.userId}},handleEditRoleResource:function(e){this.ifShowEditResourceDialog=!0,this.currentRole=e}}},c=u,f=(a("02d0"),a("2877")),h=Object(f["a"])(c,r,o,!1,null,"688ecd72",null);t["default"]=h.exports},7102:function(e,t,a){"use strict";var r=a("aca4"),o=a.n(r);o.a},"783d":function(e,t,a){"use strict";var r=a("103c"),o=a.n(r);o.a},8421:function(e,t,a){"use strict";var r=a("b744"),o=a.n(r);o.a},"866c":function(e,t,a){"use strict";var r=a("9812"),o=a.n(r);o.a},"8c703":function(e,t,a){"use strict";var r=a("e934"),o=a.n(r);o.a},"90a1":function(e,t,a){},9812:function(e,t,a){},a6e3:function(e,t,a){},aaaa:function(e,t,a){},aabc:function(e,t,a){"use strict";var r=a("410b"),o=a.n(r);o.a},ac66:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.ifShowDialog,width:"30%",top:"10vh"},on:{"update:visible":function(t){e.ifShowDialog=t}}},[a("div",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"title"},slot:"title"},[e._v("添加角色")]),e._v(" "),a("el-form",{ref:"newRoleData",attrs:{model:e.newRoleData,rules:e.newRoleDataRule}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name","label-width":"80px"}},[a("el-input",{attrs:{autocomplete:"off",maxlength:"20","show-word-limit":""},model:{value:e.newRoleData.name,callback:function(t){e.$set(e.newRoleData,"name",t)},expression:"newRoleData.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色描述",prop:"remark","label-width":"80px"}},[a("el-input",{attrs:{autocomplete:"off",maxlength:"50","show-word-limit":""},model:{value:e.newRoleData.remark,callback:function(t){e.$set(e.newRoleData,"remark",e._n(t))},expression:"newRoleData.remark"}})],1),e._v(" "),a("el-form-item",{staticClass:"mb0",attrs:{label:"是否启用",prop:"enabled","label-width":"80px"}},[a("el-radio",{attrs:{label:"true"},model:{value:e.newRoleData.enabled,callback:function(t){e.$set(e.newRoleData,"enabled",t)},expression:"newRoleData.enabled"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"false"},model:{value:e.newRoleData.enabled,callback:function(t){e.$set(e.newRoleData,"enabled",t)},expression:"newRoleData.enabled"}},[e._v("否")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.ifShowDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("清 空")]),e._v(" "),e.$api.buttonAuth("role/add")?a("el-button",{attrs:{loading:e.isEditing,type:"primary"},on:{click:e.addRole}},[e._v("添 加")]):e._e()],1)],1)},o=[],n=a("4360"),i={name:"RoleAdd",props:{ifShowAddRoleDialog:Boolean},data:function(){return{newRoleData:{name:"",remark:"",enabled:"true",createById:n["a"].getters.userId},newRoleDataRule:{name:[{required:!0,message:"请输入角色名"}]},isEditing:!1}},computed:{ifShowDialog:{get:function(){return this.ifShowAddRoleDialog},set:function(e){this.$emit("update:ifShowAddRoleDialog",e)}}},methods:{resetForm:function(){this.$refs["newRoleData"].resetFields(),this.$refs["newRoleData"].clearValidate()},addRole:function(){var e=this;this.$refs["newRoleData"].validate(function(t){if(!t)return!1;e.isEditing=!0,e.$api.role.addRole(e.newRoleData).then(function(t){e.isEditing=!1,e.ifShowDialog=!1,e.$emit("getRoleData")}).catch(function(t){e.isEditing=!1,e.$message.error(t.message)})})}}},l=i,s=a("2877"),d=Object(s["a"])(l,r,o,!1,null,null,null);t["default"]=d.exports},aca4:function(e,t,a){},af73:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.showDialog,width:"700px",top:"10vh"},on:{"update:visible":function(t){e.showDialog=t}}},[a("div",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"title"},slot:"title"},[e._v("添加新用户")]),e._v(" "),a("el-form",{ref:"newUserData",attrs:{model:e.newUserData,rules:e.newUserDataRule}},[a("el-form-item",{attrs:{label:"账号名",prop:"account","label-width":e.labelWidth}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":"",autocomplete:"off"},model:{value:e.newUserData.account,callback:function(t){e.$set(e.newUserData,"account",t)},expression:"newUserData.account"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户名称",prop:"name","label-width":e.labelWidth}},[a("el-input",{attrs:{autocomplete:"off",maxlength:"20","show-word-limit":""},model:{value:e.newUserData.name,callback:function(t){e.$set(e.newUserData,"name",t)},expression:"newUserData.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"手机号码",prop:"phone","label-width":e.labelWidth}},[a("el-input",{attrs:{maxlength:"11","show-word-limit":"",autocomplete:"off"},model:{value:e.newUserData.phone,callback:function(t){e.$set(e.newUserData,"phone",t)},expression:"newUserData.phone"}})],1),e._v(" "),e.onlyMerchantUser?e._e():a("el-form-item",{attrs:{label:"用户类型",prop:"type","label-width":e.labelWidth}},[a("el-radio",{attrs:{label:"1"},model:{value:e.newUserData.type,callback:function(t){e.$set(e.newUserData,"type",t)},expression:"newUserData.type"}},[e._v("内部用户")]),e._v(" "),a("el-radio",{attrs:{label:"2"},model:{value:e.newUserData.type,callback:function(t){e.$set(e.newUserData,"type",t)},expression:"newUserData.type"}},[e._v("商户用户")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"1"===e.newUserData.type,expression:"newUserData.type === '1'"}],attrs:{label:"组织架构",prop:"departmentCode","label-width":e.labelWidth,rules:[{required:"1"===e.newUserData.type,message:"请选择组织架构"}]}},[a("el-cascader",{attrs:{options:e.departmentOptions,props:{checkStrictly:!0,value:"code",label:"name",expandTrigger:"hover"},clearable:""},model:{value:e.newUserData.departmentCode,callback:function(t){e.$set(e.newUserData,"departmentCode",t)},expression:"newUserData.departmentCode"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"2"===e.newUserData.type,expression:"newUserData.type === '2'"}],attrs:{label:"对应商户",prop:"merchantId","label-width":e.labelWidth,rules:[{required:"2"===e.newUserData.type,message:"请选择对应商户"}]}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.newUserData.merchantId,callback:function(t){e.$set(e.newUserData,"merchantId",t)},expression:"newUserData.merchantId"}},e._l(e.aryMerchantId,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否启用",prop:"enabled","label-width":e.labelWidth}},[a("el-radio",{attrs:{label:"true"},model:{value:e.newUserData.enabled,callback:function(t){e.$set(e.newUserData,"enabled",t)},expression:"newUserData.enabled"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"false"},model:{value:e.newUserData.enabled,callback:function(t){e.$set(e.newUserData,"enabled",t)},expression:"newUserData.enabled"}},[e._v("否")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("清 空")]),e._v(" "),a("el-button",{attrs:{loading:e.ifSubmitting,type:"primary"},on:{click:function(t){return e.addUser()}}},[e._v("添 加")])],1)],1)},o=[],n=(a("6b54"),a("ac6a"),{name:"UserAdd",props:{showUserAddDialog:{type:Boolean,default:!1},onlyMerchantUser:{type:Boolean,default:!1}},data:function(){return{ifSubmitting:!1,aryMerchantId:[],departmentOptions:[],newUserData:{account:"",password:"",name:"",phone:"",type:"1",sex:"1",merchantId:"",enabled:"true",departmentCode:"",createById:this.$store.getters.userId},newUserDataRule:{account:[{required:!0,message:"请输入账号名",trigger:"blur"}],name:[{required:!0,message:"请输入用户名称",trigger:"blur"}],phone:[{required:!0,message:"请填写手机号"},{validator:this.$validater.strNumber,trigger:"blur"}],type:[{required:!0,message:"请选择用户类型",trigger:"blur"}]},labelWidth:"90px"}},computed:{showDialog:{get:function(){return this.showUserAddDialog},set:function(e){this.resetForm(),this.$emit("update:showUserAddDialog",e)}}},watch:{showDialog:function(e){var t=this;e&&(0===this.aryMerchantId.length&&this.$api.merchant.getEnabledMerchant().then(function(e){t.aryMerchantId=[],e.data.forEach(function(e){t.aryMerchantId.push({value:e.id,label:e.shortName})})}),0===this.departmentOptions.length&&this.$api.department.getDepartment().then(function(e){t.departmentOptions=t.$dataFormater.generateDepartment(e.data)}))}},methods:{addUser:function(){var e=this;this.$refs["newUserData"].validate(function(t){if(!t)return!1;e.ifSubmitting=!0,e.$api.user.addUser(e.formateNewUserData(e.newUserData)).then(function(t){e.$message.success(t.message),e.showDialog=!1,e.ifSubmitting=!1,e.$emit("getUserData")}).catch(function(t){e.ifSubmitting=!1,e.$message.error(t.message)})})},formateNewUserData:function(e){var t=Object.assign({},e),a=t.phone.toString();return t.password=a.substring(a.length-6),"1"===t.type?(t.merchantId="",t.departmentCode=t.departmentCode[t.departmentCode.length-1]):"2"===t.type&&(t.departmentCode=""),t},resetForm:function(){this.$refs["newUserData"].resetFields(),this.$refs["newUserData"].clearValidate()}}}),i=n,l=(a("8421"),a("2877")),s=Object(l["a"])(i,r,o,!1,null,"cc55a8b8",null);t["default"]=s.exports},b744:function(e,t,a){},bb8c:function(e,t,a){"use strict";var r=a("4e74"),o=a.n(r);o.a},bff3:function(e,t,a){},cc2a:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.ifShowDialog,width:"30%",top:"5vh","custom-class":"roleManage_resourceEditDialog"},on:{"update:visible":function(t){e.ifShowDialog=t}}},[a("div",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"title"},slot:"title"},[e._v("\n    编辑\n    "),a("strong",[e._v(e._s(e.currentRoleData.name))]),e._v(" 的资源\n  ")]),e._v(" "),a("div",{attrs:{slot:"default",id:"roleResourceTree"},slot:"default"},[a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.ifLoadingRoleData,expression:"ifLoadingRoleData"}],ref:"resourceTree",attrs:{data:e.allResourceData,"check-on-click-node":"","node-key":"id",props:e.defaultProps,"highlight-current":"","show-checkbox":"","default-expand-all":!1,"default-checked-keys":e.defaultCheckedKeys},on:{"update:data":function(t){e.allResourceData=t},check:e.handleCheck}})],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.ifShowDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重 置")]),e._v(" "),a("el-button",{attrs:{loading:e.ifUpdating,type:"primary",disabled:e.isSubmitDisable},on:{click:e.editRoleResource}},[e._v("更 新")])],1)])},o=[],n=(a("ac6a"),a("4360")),i=a("0003"),l={name:"RoleResourceEditIndex",props:{ifShowResourceDialog:Boolean,currentRoleData:{type:Object,default:function(){return{}}}},data:function(){return{ifLoadingRoleData:!1,isSubmitDisable:!0,ifUpdating:!1,defaultProps:{children:"children",label:"name"},defaultAllCheckedKeys:[],defaultCheckedKeys:[],currentCheckedKeys:[],allResourceData:[]}},computed:{ifShowDialog:{get:function(){return this.ifShowResourceDialog},set:function(e){this.$emit("update:ifShowResourceDialog",e)}}},watch:{ifShowDialog:function(e,t){var a=this;e?(this.ifLoadingRoleData=!0,this.currentCheckedKeys=[],this.$api.resource.getResourceByRole(this.currentRoleData).then(function(e){a.allResourceData=Object(i["b"])(e.data),a.defaultAllCheckedKeys=a.getAllCheckedResourceAry(a.allResourceData,[]),a.defaultCheckedKeys=a.getCheckedResourceAry(a.allResourceData,[]),a.ifLoadingRoleData=!1})):(this.defaultAllCheckedKeys=[],this.defaultCheckedKeys=[],this.currentCheckedKeys=[],this.allResourceData=[])},currentCheckedKeys:{handler:function(e,t){this.isSubmitDisable=this.$lib.isObjEqual(e,this.defaultAllCheckedKeys)},deep:!0}},methods:{handleCheck:function(e,t){this.currentCheckedKeys=t.checkedKeys},getCheckedResourceAry:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.forEach(function(e){e.isSelected&&(e.children&&0!==e.children.length?t.getCheckedResourceAry(e.children,a):a.push(e.id))}),a},getAllCheckedResourceAry:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.forEach(function(e){e.isSelected&&(e.children&&0!==e.children.length?(a.push(e.id),t.getAllCheckedResourceAry(e.children,a)):a.push(e.id))}),a},editRoleResource:function(){var e=this;this.ifUpdating=!0,this.$api.role.editRoleResource({roleId:this.currentRoleData.id,resourceIds:this.$refs.resourceTree.getCheckedKeys().concat(this.$refs.resourceTree.getHalfCheckedKeys()),createById:n["a"].getters.userId}).then(function(t){e.ifUpdating=!1,e.ifShowDialog=!1}).catch(function(t){return e.ifShowDialog=!1,e.$message.error(t.message),!1})},resetForm:function(){this.currentCheckedKeys=this.defaultAllCheckedKeys,this.$refs.resourceTree.setCheckedKeys(this.defaultCheckedKeys)}}},s=l,d=(a("6332"),a("2877")),u=Object(d["a"])(s,r,o,!1,null,null,null);t["default"]=u.exports},d716:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{visible:e.ifShowDialog,width:"30%",top:"10vh"},on:{"update:visible":function(t){e.ifShowDialog=t}}},[a("div",{staticStyle:{"text-align":"center","font-size":"20px"},attrs:{slot:"title"},slot:"title"},[e._v("编辑角色")]),e._v(" "),a("el-form",{ref:"newRoleData",attrs:{model:e.newRoleData,rules:e.newRoleDataRule}},[a("el-form-item",{attrs:{label:"角色名称",prop:"name","label-width":"80px"}},[a("el-input",{attrs:{autocomplete:"off",maxlength:"20","show-word-limit":""},model:{value:e.newRoleData.name,callback:function(t){e.$set(e.newRoleData,"name",t)},expression:"newRoleData.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色描述",prop:"remark","label-width":"80px"}},[a("el-input",{attrs:{autocomplete:"off",maxlength:"50","show-word-limit":""},model:{value:e.newRoleData.remark,callback:function(t){e.$set(e.newRoleData,"remark",e._n(t))},expression:"newRoleData.remark"}})],1),e._v(" "),a("el-form-item",{staticClass:"mb0",attrs:{label:"是否启用",prop:"enabled","label-width":"80px"}},[a("el-radio",{attrs:{label:"true"},model:{value:e.newRoleData.enabled,callback:function(t){e.$set(e.newRoleData,"enabled",t)},expression:"newRoleData.enabled"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"false"},model:{value:e.newRoleData.enabled,callback:function(t){e.$set(e.newRoleData,"enabled",t)},expression:"newRoleData.enabled"}},[e._v("否")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.ifShowDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{on:{click:e.resetForm}},[e._v("重 置")]),e._v(" "),e.$api.buttonAuth("role/edit")?a("el-button",{attrs:{loading:e.isEditing,type:"primary",disabled:e.isSubmitDisable},on:{click:e.editRole}},[e._v("更 新")]):e._e()],1)],1)},o=[],n={name:"RoleEdit",props:{ifShowEditRoleDialog:Boolean,currentRoleData:{type:Object,default:function(){return{}}}},data:function(){return{newRoleData:{},newRoleDataRule:{name:[{required:!0,message:"请输入角色名"}]},isSubmitDisable:!0,isEditing:!1}},computed:{ifShowDialog:{get:function(){return this.ifShowEditRoleDialog},set:function(e){this.$emit("update:ifShowEditRoleDialog",e)}}},watch:{currentRoleData:function(e){this.newRoleData=JSON.parse(JSON.stringify(e))},newRoleData:{handler:function(e,t){this.isSubmitDisable=this.$lib.isObjEqual(e,this.currentRoleData)},deep:!0}},methods:{resetForm:function(){this.$refs["newRoleData"].clearValidate(),this.newRoleData=JSON.parse(JSON.stringify(this.currentRoleData))},editRole:function(){var e=this;this.$refs["newRoleData"].validate(function(t){if(!t)return!1;e.isEditing=!0,e.$api.role.editRole(e.newRoleData).then(function(t){e.isEditing=!1,e.ifShowDialog=!1,e.$emit("getRoleData")}).catch(function(t){e.isEditing=!1,e.$message.error(t.message)})})}}},i=n,l=a("2877"),s=Object(l["a"])(i,r,o,!1,null,null,null);t["default"]=s.exports},e934:function(e,t,a){},f4c9:function(e,t,a){},f794:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"systenManage_menu"},[a("el-row",{staticClass:"choosePlatform"},[a("el-col",{attrs:{span:24}},[a("el-menu",{staticClass:"choosePlatform_menu",attrs:{"default-active":e.currentPlatform,mode:"horizontal","background-color":"#F4F5F6","text-color":"#666","active-text-color":"#333"},on:{select:e.handleSelect}},[a("el-menu-item",{attrs:{index:"2"}},[e._v("运营平台菜单")]),e._v(" "),a("el-menu-item",{attrs:{index:"1"}},[e._v("开放平台菜单")])],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{staticClass:"menuSec",attrs:{span:10}},[a("h3",[e._v("菜单")]),e._v(" "),a("el-tree",{directives:[{name:"loading",rawName:"v-loading",value:e.VloadingTreeData,expression:"VloadingTreeData"}],ref:"menuTree",attrs:{data:e.treeData,"check-on-click-node":"","node-key":"id",props:e.defaultProps,"highlight-current":"","default-expanded-keys":[e.currentNodeKey]},on:{"update:data":function(t){e.treeData=t},"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.node,o=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(r.label))]),e._v(" "),e.$api.buttonAuth("menu/edit")?a("span",{staticClass:"rightClickMenu"},[a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleAddResource(1,o)}}},[e._v("添加子菜单")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleAddResource(2,o)}}},[e._v("添加同级菜单")]),e._v(" "),a("el-button",{attrs:{type:"text"},on:{click:function(t){return t.stopPropagation(),e.handleAddResource(3,o)}}},[e._v("编辑")])],1):e._e()])}}])})],1),e._v(" "),a("el-col",{staticClass:"editForm",attrs:{span:14}},[a("h3",[e._v(e._s(e.menuName)+" : "+e._s(e.operataName))]),e._v(" "),a("el-form",{ref:"formData",staticStyle:{width:"93%"},attrs:{"label-position":"right","label-width":"150px",model:e.formData,rules:e.openPlatform_rules}},[a("el-form-item",{attrs:{label:"parentId",prop:"parentId"}},[a("el-input",{attrs:{maxlength:"20","show-word-limit":""},model:{value:e.formData.parentId,callback:function(t){e.$set(e.formData,"parentId",t)},expression:"formData.parentId"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"name",prop:"name"}},[a("el-input",{attrs:{maxlength:"20","show-word-limit":""},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"path",prop:"path"}},[a("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:e.formData.path,callback:function(t){e.$set(e.formData,"path",t)},expression:"formData.path"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"component",prop:"component"}},[a("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:e.formData.component,callback:function(t){e.$set(e.formData,"component",t)},expression:"formData.component"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"uri",prop:"uri"}},[a("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:e.formData.uri,callback:function(t){e.$set(e.formData,"uri",t)},expression:"formData.uri"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"type",prop:"type"}},[a("el-radio",{attrs:{label:"1"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[e._v("菜单")]),e._v(" "),a("el-radio",{attrs:{label:"2"},model:{value:e.formData.type,callback:function(t){e.$set(e.formData,"type",t)},expression:"formData.type"}},[e._v("按钮")])],1),e._v(" "),a("el-form-item",{attrs:{label:"systemCode",prop:"systemCode"}},[a("el-radio",{attrs:{label:"1"},model:{value:e.formData.systemCode,callback:function(t){e.$set(e.formData,"systemCode",t)},expression:"formData.systemCode"}},[e._v("开放平台")]),e._v(" "),a("el-radio",{attrs:{label:"2"},model:{value:e.formData.systemCode,callback:function(t){e.$set(e.formData,"systemCode",t)},expression:"formData.systemCode"}},[e._v("运营平台")])],1),e._v(" "),a("el-form-item",{attrs:{label:"redirect",prop:"redirect"}},[a("el-input",{attrs:{maxlength:"100","show-word-limit":""},model:{value:e.formData.redirect,callback:function(t){e.$set(e.formData,"redirect",t)},expression:"formData.redirect"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"icon",prop:"icon"}},[a("el-input",{attrs:{maxlength:"20","show-word-limit":""},model:{value:e.formData.icon,callback:function(t){e.$set(e.formData,"icon",t)},expression:"formData.icon"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"sequence",prop:"sequence"}},[a("el-input",{attrs:{maxlength:"4","show-word-limit":""},model:{value:e.formData.sequence,callback:function(t){e.$set(e.formData,"sequence",e._n(t))},expression:"formData.sequence"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"remark",prop:"remark"}},[a("el-input",{attrs:{maxlength:"50","show-word-limit":""},model:{value:e.formData.remark,callback:function(t){e.$set(e.formData,"remark",t)},expression:"formData.remark"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"rightControl",prop:"rightControl"}},[a("el-radio-group",{model:{value:e.formData.rightControl,callback:function(t){e.$set(e.formData,"rightControl",t)},expression:"formData.rightControl"}},[a("el-radio",{attrs:{label:"true"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"false"}},[e._v("否")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"enabled",prop:"enabled"}},[a("el-radio-group",{model:{value:e.formData.enabled,callback:function(t){e.$set(e.formData,"enabled",t)},expression:"formData.enabled"}},[a("el-radio",{attrs:{label:"true"}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:"false"}},[e._v("否")])],1)],1),e._v(" "),e.$api.buttonAuth("menu/edit")?a("el-form-item",{attrs:{size:"large"}},[a("el-button",{on:{click:e.resetForm}},[e._v("重置")]),e._v(" "),3!==e.operataCode?a("el-button",{attrs:{loading:e.ifSubmitting,type:"primary"},on:{click:e.addResource}},[e._v("添加")]):a("el-button",{attrs:{loading:e.ifSubmitting,type:"primary",disabled:e.isSubmitDisable},on:{click:e.editResource}},[e._v("更新")])],1):e._e()],1)],1)],1)],1)},o=[],n=(a("6b54"),a("ac6a"),a("7f7f"),a("4360")),i=a("0003"),l={name:"SystemMenu",data:function(){return{currentPlatform:"2",currentNodeData:"",currentDefaultNodeData:"",operataCode:-1,VloadingTreeData:!1,ifSubmitting:!1,isSubmitDisable:!0,currentNodeKey:"",treeData:[],operatePlatformData:[],openPlatformData:[],defaultProps:{children:"children",label:"name"},formData:{parentId:"",name:"",path:"",component:"",redirect:"",icon:"",uri:"",type:"1",sequence:null,remark:"",systemCode:"1",enabled:"true",rightControl:"true",createById:n["a"].getters.userId},openPlatform_rules:{parentId:[{required:!0,message:"请输入 parentId",trigger:"blur"}],name:[{required:!0,message:"请输入 name",trigger:"blur"}],uri:[{required:!0,message:"请输入 uri",trigger:"blur"},{min:0,max:100,message:"uri 必须少于100个字符",trigger:"blur"}],path:[{required:!0,message:"请输入 path",trigger:"blur"}],component:[{required:!0,message:"请输入 component",trigger:"blur"}],type:[{required:!0,message:"请选择 type",trigger:"change"}],systemCode:[{required:!0,message:"请选择 systemCode",trigger:"change"}],sequence:[{type:"number",message:"sequence 必须填入数字"}]}}},computed:{menuName:function(){return this.currentNodeData.name?this.currentNodeData.name:"菜单"},operataName:function(){switch(this.operataCode){case 1:return"添加子菜单";case 2:return"添加同级菜单";case 3:return"编辑";default:return"管理"}}},watch:{formData:{handler:function(e,t){this.isSubmitDisable=this.$lib.isObjEqual(e,this.currentDefaultNodeData)},deep:!0}},mounted:function(){this.getTreeData()},updated:function(){this.$refs.menuTree.setCurrentKey(this.currentNodeKey)},methods:{handleSelect:function(e){this.currentPlatform=e,this.treeData="1"===e?this.openPlatformData:this.operatePlatformData,this.currentNodeData="",this.operataCode=-1,this.updateFormData()},setData:function(e){var t=[],a=[];e.forEach(function(e){1===e.systemCode?a.push(e):2===e.systemCode&&t.push(e)}),this.operatePlatformData=Object(i["b"])(t),this.openPlatformData=Object(i["b"])(a),this.treeData="1"===this.currentPlatform?this.openPlatformData:this.operatePlatformData,this.VloadingTreeData=!1},getTreeData:function(){var e=this;this.VloadingTreeData=!0,this.$api.resource.getResource(n["a"].getters.token).then(function(t){e.setData(t.data)})},handleNodeClick:function(e,t,a){this.clearForm(),this.currentNodeKey=e.id},updateFormData:function(){var e=this.operataCode,t=this.currentNodeData;3===e?(this.formData={id:t.id.toString(),parentId:t.parentId.toString(),name:t.name,path:t.path,uri:t.uri,component:t.component,redirect:t.redirect,icon:t.icon,type:t.type.toString(),sequence:t.sequence,remark:t.remark,enabled:t.enabled.toString(),rightControl:t.rightControl.toString(),systemCode:t.systemCode.toString(),updateById:this.$store.getters.userId.toString()},this.currentDefaultNodeData=JSON.parse(JSON.stringify(this.formData))):this.formData={parentId:1===e?t.id.toString():2===e?t.parentId.toString():"",name:"",path:"",uri:"",component:"",redirect:"",icon:"",type:"1",sequence:null,remark:"",systemCode:"1",enabled:"true",rightControl:"true",createById:this.$store.getters.userId.toString()}},handleAddResource:function(e,t){this.operataCode=e,this.currentNodeData=t,this.currentNodeKey=t.id,this.resetForm()},addResource:function(){var e=this;this.$refs["formData"].validate(function(t){if(!t)return!1;e.ifSubmitting=!0,e.$api.resource.addResource(e.formaterFormData()).then(function(t){e.clearForm(),e.getTreeData(),e.ifSubmitting=!1}).catch(function(t){e.ifSubmitting=!1,e.$message.error(t.message)})})},editResource:function(){var e=this;this.$refs["formData"].validate(function(t){if(!t)return!1;e.ifSubmitting=!0,e.$api.resource.editResource(e.formaterFormData()).then(function(t){e.clearForm(),e.getTreeData(),e.ifSubmitting=!1}).catch(function(t){e.ifSubmitting=!1,e.$message.error(t.message)})})},clearForm:function(){this.currentNodeData="",this.operataCode=-1,this.updateFormData()},resetForm:function(){this.updateFormData()},formaterFormData:function(){var e=JSON.parse(JSON.stringify(this.formData));return e["systemCode"]=parseInt(e["systemCode"]),e["type"]=parseInt(e["type"]),e}}},s=l,d=(a("bb8c"),a("aabc"),a("2877")),u=Object(d["a"])(s,r,o,!1,null,"3feab645",null);t["default"]=u.exports}}]);