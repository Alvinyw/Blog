(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["addBankCard"],{"14c3":function(e,a,r){var t=r("c6b6"),n=r("9263");e.exports=function(e,a){var r=e.exec;if("function"===typeof r){var i=r.call(e,a);if("object"!==typeof i)throw TypeError("RegExp exec method returned something other than an Object or null");return i}if("RegExp"!==t(e))throw TypeError("RegExp#exec called on incompatible receiver");return n.call(e,a)}},1784:function(e,a,r){e.exports=r.p+"static/img/img_bankCardOCR_card.1d66e41f.png"},5319:function(e,a,r){"use strict";var t=r("d784"),n=r("825a"),i=r("7b0b"),s=r("50c4"),c=r("a691"),o=r("1d80"),d=r("8aa5"),u=r("14c3"),l=Math.max,f=Math.min,p=Math.floor,h=/\$([$&'`]|\d\d?|<[^>]*>)/g,m=/\$([$&'`]|\d\d?)/g,b=function(e){return void 0===e?e:String(e)};t("replace",2,(function(e,a,r){return[function(r,t){var n=o(this),i=void 0==r?void 0:r[e];return void 0!==i?i.call(r,n,t):a.call(String(n),r,t)},function(e,i){var o=r(a,e,this,i);if(o.done)return o.value;var p=n(e),h=String(this),m="function"===typeof i;m||(i=String(i));var g=p.global;if(g){var v=p.unicode;p.lastIndex=0}var C=[];while(1){var k=u(p,h);if(null===k)break;if(C.push(k),!g)break;var N=String(k[0]);""===N&&(p.lastIndex=d(h,s(p.lastIndex),v))}for(var x="",y=0,$=0;$<C.length;$++){k=C[$];for(var w=String(k[0]),I=l(f(c(k.index),h.length),0),_=[],A=1;A<k.length;A++)_.push(b(k[A]));var M=k.groups;if(m){var S=[w].concat(_,I,h);void 0!==M&&S.push(M);var B=String(i.apply(void 0,S))}else B=t(w,h,I,_,M,i);I>=y&&(x+=h.slice(y,I)+B,y=I+w.length)}return x+h.slice(y)}];function t(e,r,t,n,s,c){var o=t+e.length,d=n.length,u=m;return void 0!==s&&(s=i(s),u=h),a.call(c,u,(function(a,i){var c;switch(i.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,t);case"'":return r.slice(o);case"<":c=s[i.slice(1,-1)];break;default:var u=+i;if(0===u)return a;if(u>d){var l=p(u/10);return 0===l?a:l<=d?void 0===n[l-1]?i.charAt(1):n[l-1]+i.charAt(1):a}c=n[u-1]}return void 0===c?"":c}))}}))},6547:function(e,a,r){var t=r("a691"),n=r("1d80"),i=function(e){return function(a,r){var i,s,c=String(n(a)),o=t(r),d=c.length;return o<0||o>=d?e?"":void 0:(i=c.charCodeAt(o),i<55296||i>56319||o+1===d||(s=c.charCodeAt(o+1))<56320||s>57343?e?c.charAt(o):i:e?c.slice(o,o+2):s-56320+(i-55296<<10)+65536)}};e.exports={codeAt:i(!1),charAt:i(!0)}},"85ad":function(e,a,r){"use strict";var t=r("f828"),n=r.n(t);n.a},"8aa5":function(e,a,r){"use strict";var t=r("6547").charAt;e.exports=function(e,a,r){return a+(r?t(e,a).length:1)}},9844:function(e,a,r){},abef:function(e,a,r){"use strict";r.r(a);var t=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{attrs:{id:"addBankCard_index"}},[t("NavBar",{attrs:{title:"绑定银行卡","left-arrow":""},on:{"click-left":function(a){return e.$router.go(-1)}}}),t("div",{staticClass:"cardSec g_container"},[t("BankCard",{attrs:{"card-info":e.bankCardInfo}})],1),t("div",{staticClass:"formSec g_container",attrs:{loading:!0}},[t("div",{staticClass:"bankCard-bind"},[t("van-field",{class:""===e.bankCardInfo.cardNumber?"":"fb",attrs:{maxlength:"19",label:"银行卡号",placeholder:"请输入银行卡号","error-message":e.errMsg_cardNumber},model:{value:e.bankCardInfo.cardNumber,callback:function(a){e.$set(e.bankCardInfo,"cardNumber",a)},expression:"bankCardInfo.cardNumber"}}),t("span",{staticClass:"camera-wrap",on:{click:e.onFileChange}},[t("i",{staticClass:"icon-camera"})])],1),t("van-field",{class:""===e.cardMobile?"":"fb",attrs:{maxlength:"11",label:"预留手机号",placeholder:"请输入预留手机号","error-message":e.errMsg_cardMobile},model:{value:e.cardMobile,callback:function(a){e.cardMobile=a},expression:"cardMobile"}}),t("SMSVerificationCode",{attrs:{"is-valid":e.isValidCodeCorrect},on:{"update:isValid":function(a){e.isValidCodeCorrect=a},"update:is-valid":function(a){e.isValidCodeCorrect=a}}})],1),t("div",{staticClass:"btm-sec g_container"},[t("div",{staticClass:"confirmSrc"},[t("van-checkbox",{attrs:{shape:"square"},on:{change:e.onAgreementChange},model:{value:e.ifAcceptAgreement,callback:function(a){e.ifAcceptAgreement=a},expression:"ifAcceptAgreement"}}),t("p",[e._v(" 阅读并同意 "),t("router-link",{attrs:{to:{name:"agreement",query:{agreementSrc:r("acc1")}}}},[e._v("《用户授权书》")]),e._v("、 "),t("router-link",{attrs:{to:{name:"agreement",query:{agreementSrc:r("ffea")}}}},[e._v("《个人信息授权书》")])],1)],1),t("van-button",{directives:[{name:"waves",rawName:"v-waves"}],attrs:{type:"primary",disabled:e.isSubmitDisable},on:{click:e.nextStep}},[e._v("下一步")])],1),t("CamerasAlbums",{attrs:{"if-show-file-upload":e.ifShowFileUpload},on:{"update:ifShowFileUpload":function(a){e.ifShowFileUpload=a},"update:if-show-file-upload":function(a){e.ifShowFileUpload=a},setData:e.OCRbankCard}})],1)},n=[],i=(r("0d03"),r("d3b7"),r("ac1f"),r("25f0"),r("5319"),r("96cf"),r("89ba")),s=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{staticClass:"addBankCard-card",class:e.cardInfo.cardNumber?"hasNum":""},[t("img",{staticClass:"img-yinlian",attrs:{src:r("1784"),alt:""}}),t("ul",[t("li",{staticClass:"cardChinaName"},[e._v(e._s(e.cardInfo.cardChinaName))]),t("li",{staticClass:"cardType"},[e._v(e._s(e._f("filterBankCardType")(e.cardInfo.cardType)))]),t("li",{staticClass:"cardNumber"},[e._v(" "+e._s(e.number.replace(/\D/g,"").replace(/....(?!$)/g,"$& "))+" ")]),t("li",{directives:[{name:"show",rawName:"v-show",value:!e.cardInfo.cardNumber,expression:"!cardInfo.cardNumber"}],staticClass:"defaultNumber"},[t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span"),t("span")])])])},c=[],o={name:"BankCard",props:{cardInfo:{type:Object,default:function(){return{cardChinaName:"银行名称",cardType:"0",cardNumber:""}}}},data:function(){return{number:""}},watch:{"cardInfo.cardNumber":function(e){this.number=e.replace(/\s/g,"").replace(/(\d{4})(?=\d)/g,"$1 ")}},mounted:function(){this.number=this.cardInfo.cardNumber.replace(/\s/g,"").replace(/(\d{4})(?=\d)/g,"$1 ")}},d=o,u=(r("e2b2"),r("2877")),l=Object(u["a"])(d,s,c,!1,null,"2c57a8fe",null),f=l.exports,p={name:"AddBankCard",components:{BankCard:f},data:function(){return{ifAcceptAgreement:"true"===this.$session.getAddBankCardAgreementState(),ifShowFileUpload:!1,cardMobile:this.$session.getBankCardForm().cardPhone||"",errMsg_cardMobile:"",bankCardInfo:{cardNumber:this.$session.getBankCardForm().cardNumber||"",cardType:this.$session.getBankCardForm().cardType||"0",cardName:"",cardChinaName:this.$session.getBankCardForm().cardChinaName||"银行名称"},errMsg_cardNumber:"",isValidCodeCorrect:!1}},computed:{isSubmitDisable:function(){return!(this.ifAcceptAgreement&&this.isValidCodeCorrect&&this.bankCardInfo.cardNumber&&""===this.errMsg_cardNumber&&this.cardMobile&&""===this.errMsg_cardMobile)},isDefaultPay:function(){var e=void 0===this.$route.query.isDefaultPay||this.$route.query.isDefaultPay.toString();switch(e){case"false":return!1;default:return!0}}},watch:{"bankCardInfo.cardNumber":function(e){var a=this;this.$nextTick((function(){if(""===e)a.errMsg_cardNumber="银行卡号不能为空",a.bankCardInfo.cardType="0",a.bankCardInfo.cardChinaName="银行名称";else if(e.length<15)a.errMsg_cardNumber="银行卡号格式不正确";else{a.errMsg_cardNumber="";var r=a.$session.getBankCardForm();r.cardNumber=e,a.$session.setBankCardForm(r)}}))},cardMobile:function(e){var a=this;this.$nextTick((function(){if(""===e)a.errMsg_cardMobile="预留手机号不能为空";else if(11!==e.length)a.errMsg_cardMobile="手机号码格式不正确";else{a.errMsg_cardMobile="";var r=a.$session.getBankCardForm();r.cardPhone=e,a.$session.setBankCardForm(r)}}))}},methods:{onAgreementChange:function(e){this.$session.setAddBankCardAgreementState(e)},onFileChange:function(){this.ifShowFileUpload=!0},OCRbankCard:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(a){var r,t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$loading.show(),e.next=3,this.$api.app.bankCardOCR({base64:this.$lib.spiltBase64(a.src)});case 3:r=e.sent,r&&r.data?(t=r.data[0],this.bankCardInfo.cardNumber=t.cardNumber,this.bankCardInfo.cardChinaName=t.bankName,this.getBankCardNameAndType()):this.$notify({type:"danger",message:"银行卡识别失败！"}),this.$loading.hide();case 6:case"end":return e.stop()}}),e,this)})));function a(a){return e.apply(this,arguments)}return a}(),getBankCardNameAndType:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var a,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.$loading.show(),e.next=3,this.$api.app.getBankCardNameAndType(this.bankCardInfo.cardNumber.replace(/\s*/g,""));case 3:if(a=e.sent,this.$loading.hide(),!a||!a.data){e.next=14;break}return r=a.data[0]?a.data[0]:{},this.bankCardInfo.cardType=r.cardType,this.bankCardInfo.cardName=r.bank,this.bankCardInfo.cardChinaName=r.bankName,this.$session.setBankCardForm(this.bankCardInfo),e.abrupt("return",!0);case 14:return this.$notify({type:"danger",message:a.message}),e.abrupt("return",!1);case 16:case"end":return e.stop()}}),e,this)})));function a(){return e.apply(this,arguments)}return a}(),nextStep:function(){var e=Object(i["a"])(regeneratorRuntime.mark((function e(){var a,r,t,n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.getBankCardNameAndType();case 2:if(a=e.sent,a){e.next=5;break}return e.abrupt("return",!1);case 5:return this.$loading.show(),r=this.$session.getCustomerInfo(),t=r.customerId,e.next=9,this.$api.customer.bankCardAdd({customerId:t,cardMobile:this.cardMobile,cardNumber:this.bankCardInfo.cardNumber,cardType:this.bankCardInfo.cardType,cardName:this.bankCardInfo.cardName,cardChinaName:this.bankCardInfo.cardChinaName,defaultPay:this.isDefaultPay});case 9:n=e.sent,n&&"200"===n.code?this.isDefaultPay?this.$router.push({name:"paymentPswSetEnter"}):this.$router.push({path:"/success",query:{name:"绑定银行卡",result:"绑定成功",detail:"您的银行卡已绑定成功",routeName:"homeIndex",buttonText:"返回首页"}}):this.$notify({type:"danger",message:n.message}),this.$loading.hide();case 12:case"end":return e.stop()}}),e,this)})));function a(){return e.apply(this,arguments)}return a}()}},h=p,m=(r("85ad"),Object(u["a"])(h,t,n,!1,null,"7b18082e",null));a["default"]=m.exports},acc1:function(e,a,r){e.exports=r.p+"static/img/用户授权书.ea38a5a9.jpg"},d784:function(e,a,r){"use strict";var t=r("9112"),n=r("6eeb"),i=r("d039"),s=r("b622"),c=r("9263"),o=s("species"),d=!i((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),u=!i((function(){var e=/(?:)/,a=e.exec;e.exec=function(){return a.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]}));e.exports=function(e,a,r,l){var f=s(e),p=!i((function(){var a={};return a[f]=function(){return 7},7!=""[e](a)})),h=p&&!i((function(){var a=!1,r=/a/;return"split"===e&&(r={},r.constructor={},r.constructor[o]=function(){return r},r.flags="",r[f]=/./[f]),r.exec=function(){return a=!0,null},r[f](""),!a}));if(!p||!h||"replace"===e&&!d||"split"===e&&!u){var m=/./[f],b=r(f,""[e],(function(e,a,r,t,n){return a.exec===c?p&&!n?{done:!0,value:m.call(a,r,t)}:{done:!0,value:e.call(r,a,t)}:{done:!1}})),g=b[0],v=b[1];n(String.prototype,e,g),n(RegExp.prototype,f,2==a?function(e,a){return v.call(e,this,a)}:function(e){return v.call(e,this)}),l&&t(RegExp.prototype[f],"sham",!0)}}},e2b2:function(e,a,r){"use strict";var t=r("9844"),n=r.n(t);n.a},f828:function(e,a,r){},ffea:function(e,a,r){e.exports=r.p+"static/img/个人信息使用授权书.6202ab8a.jpg"}}]);